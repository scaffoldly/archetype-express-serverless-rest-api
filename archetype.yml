
---
script:
  - rules:
      - destination:
          overwrite: true

  - set:
      repository-name:
        prompt: "Repository Name?"
      auth:
        prompt: "Auth Service Exists?"
        type: bool
        default: false
      persistence:
        prompt: "Persistence Type?"
        type:
          enum:
            - none
            - dynamodb
        default: none

  - if:
      conditions:
        - switch-enabled: github
      then:
        - render:
            directory:
              source: "github"

  - if:
      conditions:
        - switch-enabled: serverless
      then:
        - set:
            service-name:
              value: "{{ repository-name | trim_end_matches(pat='-sls-rest-api') }}"
        - render:
            directory:
              source: "serverless"

  - if:
      conditions:
        - switch-enabled: serverless
      then:
        - scope:
            - rules:
                - destination:
                    overwrite: false
            - render:
                directory:
                  source: "immutable/serverless"
            - render:
                directory:
                  source: "immutable/git"
                  destination: ".git"
            - exec:
                command: chmod
                args:
                  - "ugo+x"
                  - ".git/hooks/pre-commit"

  - if:
      conditions:
        - switch-enabled: entity
        - is-true: "{{ persistence == 'dynamodb' }}"
      then:
        - set:
            entities:
              prompt: "Entities?"
              default: ""
              type: list
        - rules:
            - destination:
                overwrite: false
        - for:
            item:
              in: entities
            do:
              - scope:
                - set:
                    Entity:
                      value: "{{ item | pascal_case }}"
                    entity:
                      value: "{{ item | lower_case }}"
                    entityId:
                      value: "{{ entity }}Id"
                    entityRequest:
                      value: "{{ entity }}Request"
                    EntityRequest:
                      value: "{{ Entity }}Request"
                    EntityResponse:
                      value: "{{ Entity }}Response"
                    EntityListResponse:
                      value: "{{ Entity }}ListResponse"
                    EntityService:
                      value: "{{ Entity }}Service"
                    entityService:
                      value: "{{ entity }}Service"
                    EntityControllerV1:
                      value: "{{ Entity }}ControllerV1"
                    entityModel:
                      value: "{{ entity }}Model"
                    EntityModel:
                      value: "{{ Entity }}Model"
                    isEntity:
                      value: "is{{ Entity }}"
                - info: "Rendering {{ item }} entity for DynamoDB"
                - render:
                    directory:
                      source: "immutable/dynamodb"
